# PRD: Улучшение опросников и тренировочного флоу

Дата: 2026-01-15  
Статус: Draft  
Владелец: Product Owner

## Контекст и проблема
Сейчас опросники на главной странице, до и после упражнения фиксируют в основном боль и базовые факторы дня. Это не дает комплексной картины физического состояния пользователя и снижает мотивацию к регулярному заполнению. В UI есть проблемы с навигацией между списками и карточками упражнений/программ, а также недостаток информации на экране старта упражнения. Для силовых упражнений отсутствует корректный режим работы по подходам и повторениям, из-за чего тренировка не соответствует плану.

## Исследовательская валидация рекомендаций
Ключевые выводы (desk research + UX практики):
- Длинные опросники ухудшают completion; нужен короткий обязательный минимум и раскрываемый блок "Подробнее".
- Шкалы 0-10 без якорей дают шум и снижают сопоставимость; нужны текстовые якоря и единая направленность шкалы.
- Отсутствие пользы для пользователя снижает мотивацию отвечать; нужна короткая обратная связь после сохранения.
- Потеря контекста при закрытии карточек вызывает фрустрацию; важно сохранять фильтры и позицию списка.
- В силовом режиме пользователю нужен видимый прогресс и контроль над параметрами (вес/повторы/отдых).

Уточнение рекомендаций (desk research):
- Термины readiness/RPE/ограничения без коротких пояснений повышают разброс ответов; нужны микропояснения прямо под шкалой.
- Блок "Подробнее" работает лучше при явной выгоде и оценке времени (например, "еще ~20 сек").
- Обратная связь после опроса должна иметь прозрачные пороги и повторяемую трактовку.
- Пустые состояния на старте упражнения не должны блокировать запуск; нужен текст, подтверждающий возможность продолжить.
- В силовом флоу критичны корректировки между подходами и понятные ошибки ввода без потери введенных значений.
- Для негативных конструктов (стресс) шкала должна иметь прямой смысл: 0 = "спокойно", 10 = "очень стрессово".
- Скрытая автоподстановка снижает доверие; нужна явная индикация и быстрый способ изменить значения.
- Автопереход после отдыха без предупреждения воспринимается как потеря контроля; нужен видимый отсчет и возможность остановить авто-переход.
- Тональность фидбека лучше нейтральная, с кратким следующим шагом, чтобы не демотивировать.
- Мультивыбор "ограничения" без варианта "Другое" дает потери контекста; нужен опциональный текстовый ввод.
- Дублирующие конструкты (готовность + усталость на одном экране) повышают когнитивную нагрузку и снижают надежность; в core оставлять один.
- Разные диапазоны шкал без явной маркировки ухудшают понимание; RPE (1-10) должен быть визуально выделен и подписан.
- Prefill из daily ускоряет ввод, но может снижать доверие; нужен быстрый контроль актуальности ("Актуально сегодня?").
- В силовом режиме часть пользователей ожидает отсутствие отдыха (0 сек) для суперсетов; запрет нуля конфликтует с их сценарием.

Быстрая проверка рекомендаций перед внедрением (mini-research):
- Готовность vs усталость: 5-7 коротких интервью с объяснением терминов на макете, измерить понимание (правильная интерпретация >= 80%).
- Список "ограничений": A/B 6-8 пунктов vs полный список, сравнить completion и время заполнения.
- Свернутый список упражнений на старте: A/B "первые 3 + Еще N" vs полный список, сравнить start rate и время до старта.
- Автопереход отдыха: тест с тумблером "Вкл/Выкл" и отсчетом, проверить восприятие контроля и ошибок.
- Возврат из deep-link: 5-7 сессий на прототипе, проверить ожидания "куда вернуло" и нужен ли явный поясняющий элемент.
- Пустое состояние описания: тест короткого safety-текста vs нейтрального, сравнить уверенность в старте.

Что нужно подтвердить в продукте:
- Базовые метрики: completion опросников, время заполнения, drop-off на старте упражнений.
- Понятность терминов (готовность, RPE, ограничения) в коротком тесте.
- Различимость readiness и fatigue в pre/post контекстах по микрокопирайту.
- Ожидания по управлению отдыхом и корректировке параметров между подходами.
- Влияние короткой обратной связи и текста "Подробнее" на готовность заполнять дополнительные вопросы.
- Восприятие автоподстановки daily (сон/стресс) и доверие к этим данным.
- Реакция на нейтральные категории готовности и их влияние на старт тренировки.
- Нужен ли контроль авто-перехода после отдыха и насколько он критичен.
- Корреляция "готовность" vs "усталость": достаточно ли одной шкалы в core.
- Понимание диапазона RPE (1-10) без путаницы со шкалами 0-10.
- Эффект опции "Нет ограничений" и длины списка ограничений на скорость заполнения.
- Предпочтения по значению отдыха = 0 (суперсеты, круговые).
- Оптимальная давность daily-подстановки (12 часов vs иной TTL).
- Понятность списка упражнений в программе при длинном списке (сканируемость).
- Предпочтительные единицы веса (кг/фунты) и сценарии "без веса".
- Предпочтения по дефолту авто-перехода после отдыха (вкл/выкл).

## Цели
- Расширить опросники, сохранив быстрый проход (<= 30 секунд).
- Повысить информативность экрана старта и снизить отказы перед началом упражнения.
- Исправить возврат в список упражнений/программ без потери контекста.
- Поддержать силовые упражнения по подходам/повторениям с контролем отдыха.

## Не-цели
- Полный редизайн интерфейса.
- Изменения в логике авторизации или регистрации.
- Переписывание модели данных в YDB.

## Роли и ответственности
- Product Owner: приоритизация требований, согласование метрик.
- UX Researcher/Designer: сценарии опросников, тексты, структура экранов.
- Frontend Developer: UI, состояние, навигация, локальные сценарии.
- Backend Developer: схема данных, валидация и синхронизация.
- QA Engineer: тест-кейсы, регрессия, приемка.

## Brief for agents (для новых чатов)
Цель: реализовать улучшения опросников, экрана старта и силового режима без редизайна, с TDD и трекингом прогресса.

Что важно помнить:
- Весь UI находится в `frontend/src/app.js`; избегать изменений в автогенерируемых файлах.
- Бэкенд: `backend/server.js`, формат данных см. раздел "Изменения модели данных".
- Сохранять совместимость со старыми данными: ленивая миграция on-read.
- Использовать TDD: сначала тесты, потом минимальные изменения, затем рефакторинг.
- Обновлять чек-листы статуса: [ ] не начато, [~] в работе, [x] готово.

Ключевые результаты:
- Опросники с core/Подробнее, шкалы с якорями, прозрачный фидбек.
- Экран старта с кратким контентом и пустыми состояниями без блокировки.
- Силовой режим по подходам с отдыхом и контролем автоперехода.
- Возврат в список без потери контекста и понятный deep-link возврат.

## Пользовательские сценарии (user stories)
1. Как пользователь, я хочу быстро оценить состояние до/после тренировки, чтобы программа учитывала мою готовность.
2. Как пользователь, я хочу закрывать карточку упражнения/программы и возвращаться в тот же список, где был.
3. Как пользователь, я хочу видеть, что входит в программу/упражнение до старта, чтобы понимать нагрузку.
4. Как пользователь, я хочу выполнять силовые упражнения по подходам и повторениям с отдыхом, чтобы тренировка соответствовала плану.

## Продуктовые принципы (UX)
- Сначала минимум, затем детали (progressive disclosure).
- Единая логика шкал и якорей.
- Пользователь всегда сохраняет контекст и контроль.
- Информация сканируема: ключевые данные на первом экране.
- Обратная связь трактуется прозрачно и повторяемо.
- Избегать дублирующих конструктов на одном экране.

## Требования к продукту

### 1) Расширенные опросники
Контексты:
- Главная страница (daily).
- Перед упражнением (pre-workout).
- После упражнения (post-workout).

Структура:
- Обязательный минимум: до 4 вопросов на один экран.
- Блок "Подробнее" раскрывает дополнительные вопросы.
- Если daily заполнен в последние 12 часов, значения сна/стресса подставляются в pre и отображаются компактно с пометкой "Из daily" и действием "Изменить".
- Над блоком "Подробнее" короткий текст выгоды + ориентир по времени (например, "Еще ~20 сек, чтобы точнее подобрать нагрузку").
- При подстановке из daily показывать быстрый контроль актуальности: "Актуально сегодня?" (Да / Изменить).

Наборы вопросов (core):
- Daily: готовность/восстановленность, качество сна, уровень стресса, ограничения/ощущения (мультивыбор + "Другое").
- Pre: готовность/энергия, ограничения/ощущения (мультивыбор + "Другое").
- Post: RPE (1-10), мышечная усталость после тренировки, ограничения/ощущения (мультивыбор + "Другое").

Наборы вопросов ("Подробнее"):
- Daily: усталость.
- Pre: усталость; сон и стресс (если daily не заполнен или пользователь выбрал "Изменить").
- Post: дополнительных вопросов нет; блок не показывать.

Шкалы и якоря:
- Готовность/сон: 0 = "очень плохо", 10 = "отлично".
- Стресс: 0 = "спокойный день", 10 = "очень стрессовый день".
- Усталость: 0 = "не устал", 10 = "максимальная усталость".
- RPE: 1 = "очень легко", 10 = "максимальное усилие".
- Показывать якоря 0/5/10 (или 1/5/10 для RPE) с краткими подписями.
- Все шкалы направлены слева направо: от низкого/легкого к высокому/тяжелому.
- Для RPE показывать явную подпись "RPE 1-10" и визуально отделять от шкал 0-10.
- Для "мышечной усталости после тренировки" использовать шкалу 0-10 с подписью "усталость мышц".

Микрокопирайтинг:
- Готовность: "Насколько вы готовы к нагрузке сейчас?"
- Подсказка под готовностью: "Это про текущую готовность, не про усталость после тренировки."
- Сон: "Оцените качество сна за последнюю ночь".
- Стресс: "Насколько стрессовым был день?"
- RPE: "Насколько тяжело было, где 10 = предел усилия?"
- Мышечная усталость: "Насколько устали мышцы после тренировки?"
- Ограничения/ощущения: "Что может повлиять на тренировку сегодня?"

Обратная связь после сохранения:
- Категории готовности по readiness: 0-3 "низкая", 4-6 "умеренная", 7-10 "высокая".
- Если readiness = `null`: "Готовность: не оценена".
- Формат: короткий результат + один нейтральный совет + CTA ("Начать тренировку" / "Продолжить").

UX-заметки:
- Ползунки + быстрые пресеты (0/5/10 или 1/5/10), сохранение последнего ответа как подсказки.
- Возможность "Пропустить" (значение = `null`, не блокирует старт упражнения).
- Если все core-вопросы пропущены, показывать подтверждение ("Продолжить без оценки?"), но не блокировать.
- Если сон/стресс подставлены из daily, показывать чип "Подставлено из daily" + действие "Изменить".
- Для подставленных значений показывать подтверждение актуальности; "Изменить" открывает блок "Подробнее".
- В списке "ограничений" добавлять "Нет ограничений" и ограничивать базовый список 6-8 пунктами + "Другое".

### 2) Навигация между списком и карточкой
Требование:
- При закрытии карточки упражнения/программы (X) или системном back возвращать пользователя в тот же список, таб, фильтр и позицию прокрутки.
- Если карточка открыта из deep-link, возврат идет на последний известный список; при отсутствии - на дефолтный каталог.
- Состояние списка хранить в памяти и в localStorage с TTL (например, 24 часа) для восстановления после перезапуска.
- Если восстановление невозможно, показывать явный CTA "Вернуться в каталог" вместо молчаливого сброса контекста.
- При возврате из deep-link показывать короткую подсказку "Вы вернулись в последний список" с CTA "В каталог".

Критерий:
- Пользователь всегда возвращается к предыдущему экрану, а не к дефолтному каталогу.

### 3) Экран старта программы/упражнения
Для программы:
- Список входящих упражнений (название + время/повторы).
- Цель/направленность.
- Инвентарь.
- Общая длительность.
- Кнопка "Начать" доступна сразу, детали - в "Подробнее".
- Порядок блоков на экране: цель/направленность -> состав -> длительность -> инвентарь (сканируемость).
- При длинном списке упражнений показывать первые 3 и CTA "Еще N", чтобы не перегружать экран.

Для упражнения:
- Краткая инструкция (2-5 пунктов).
- Тип нагрузки (время или повторения).
- Инвентарь/ограничения.
- Пояснение "что нужно делать" в 1 абзаце.
- Если данных нет - показывать краткое пустое состояние и не ломать старт.
- Пустое состояние: "Описание пока недоступно. Вы можете начать упражнение." + кнопка "Начать".

### 4) Силовые упражнения по подходам и повторениям
Определение:
- Силовое упражнение — тип, где нагрузка измеряется повторениями, а не временем.

Новый стартовый экран:
- Ввод: вес, количество подходов, повторений в подходе.
- Ввод: отдых между подходами (секунды/минуты).
- Значения по умолчанию берутся из последнего выполнения или шаблона упражнения.
- Валидация: вес >= 0, подходы/повторы > 0, отдых >= 0; верхние границы конфигурируемы.

Во время упражнения:
- Отображается текущий подход (например, 2/4) и целевое количество повторений (например, 10).
- Кнопка "Подход выполнен" переводит на экран отдыха.
- Возможность изменить вес/повторения между подходами (минимальная форма редактирования).

Экран отдыха:
- Таймер обратного отсчета.
- Кнопки "Пропустить" и "Добавить +30 сек" (контроль пользователя).
- Перед автопереходом - 3-секундный видимый отсчет и кнопка "Пауза авто-перехода".
- По окончании таймера автоматический переход к следующему подходу, если авто-переход не остановлен.
- Настройка "Авто-переход: Вкл/Выкл" доступна на экране отдыха и запоминается локально (localStorage).

Граничные случаи:
- Пользователь может завершить упражнение досрочно (с фиксацией факта).
- Если введенные значения некорректны - показывать понятную ошибку и сохранять введенное.
- При выходе из экрана упражнения и возврате показывать последний контекст (текущий подход/статус отдыха).
- Если авто-переход остановлен, показывать явную кнопку "Начать следующий подход".
- Если отдых = 0, экран отдыха пропускается и переход идет сразу к следующему подходу.

## Изменения модели данных
Текущая модель: `userData` с типами `history`, `painLogs`, `weights`, `achievements`.

Новые/расширенные сущности:
- `readinessLogs`:
  - `context`: `daily` | `pre` | `post`
  - `createdAt`
  - `completionLevel`: `core` | `full`
  - `values`: `{ readiness, fatigue, sleep, stress, limitations[], limitationsOther, rpe, postFatigue }`
  - Любое отсутствующее значение = `null`
  - `schemaVersion: 1`
  - `readinessCategory` вычисляется на фронтенде и не сохраняется.
- `history` расширяется для силовых упражнений:
  - `exerciseType: "time" | "reps"`
  - `strength`: `{ weight, sets, reps, restSec }`
  - `setsDone`: number
  - `completedAt`

## Миграция данных
Схема таблиц YDB не меняется (таблица `userData` уже хранит JSON payload).
Нужна миграция логики данных:
- При чтении: если `readinessLogs` отсутствуют — использовать пустой массив.
- При чтении `history`: если нет `exerciseType`/`strength`, считать упражнение таймерным.
- При записи новых данных: добавлять `schemaVersion`, `completionLevel` и новые поля.

Механика миграции:
- Ленивая миграция (on-read): заполнять отсутствующие поля дефолтами в памяти и сохранять при следующей синхронизации.
- Если потребуется массовое обновление — отдельный скрипт миграции в backend (по согласованию).

## Метрики успеха
- Completion опросников (daily/pre/post).
- Медианное время заполнения опросника.
- Доля заполнений `core` vs `full`, доля открытий блока "Подробнее".
- Skip rate по каждому вопросу (включая `null`).
- Drop-off: просмотр экрана старта -> старт упражнения.
- Возврат в список: доля возвратов без потери контекста.
- Силовой режим: доля завершенных подходов, частота пропуска/продления отдыха, доля ручных корректировок веса/повторов.

## Acceptance criteria
- В контекстах daily/pre доступны core-вопросы и блок "Подробнее"; в post блок не показывается.
- В core нет дублирующих шкал готовности и усталости; усталость вынесена в "Подробнее".
- Шкалы имеют текстовые якоря и единое направление.
- Под шкалами есть короткие пояснения терминов readiness/RPE/ограничения.
- RPE обозначена как шкала 1-10 и визуально отделена от шкал 0-10.
- Обратная связь после опроса использует прозрачные пороги (0-3/4-6/7-10) и категории "низкая/умеренная/высокая" либо `null`.
- Пропуск вопроса сохраняется как `null` и не блокирует старт.
- Для стресса шкала имеет прямую интерпретацию (0 = спокойно, 10 = очень стрессово).
- Подставленные из daily сон/стресс показываются явно, подтверждаются "Актуально сегодня?" и могут быть изменены.
- В списке "ограничения" есть опция "Нет ограничений" и базовый список не превышает 6-8 пунктов.
- Закрытие карточки возвращает в предыдущий список с сохранением состояния.
- Экран старта показывает содержимое программы/упражнения или корректное пустое состояние.
- Силовые упражнения выполняются по подходам и повторениям с управляемым отдыхом.
- Отдых между подходами допускает значение 0.
- Ошибки ввода в силовом режиме не сбрасывают введенные значения.
- Авто-переход после отдыха имеет предупреждение и опцию остановки.
- Авто-переход можно отключить/включить, настройка сохраняется локально.

## Риски и зависимости
- Неполные данные по упражнениям/программам для описаний (нужны исходные контенты).
- Возможны конфликтующие состояния навигации (SPA без роутинга).
- Низкая понятность терминов и шкал без отдельной UX-проверки.
- Рост времени заполнения при злоупотреблении блоком "Подробнее".
- Неподходящие пороги обратной связи могут демотивировать и снижать доверие к рекомендациям.

## План валидации (TDD/QA + UX)
- UX: 5-7 сессий на прототипах (опросники, старт, силовой флоу).
- UX: короткий тест терминов и микрокопирайта (5-10 минут) до основного прототипа.
- Аналитика: события `questionnaire_started/completed`, `start_screen_viewed`, `exercise_started`, `back_to_list`, `rest_skipped`.
- Аналитика: `questionnaire_details_opened`, `question_skipped`, `readiness_feedback_viewed`, `strength_param_changed`.
- Аналитика: `daily_prefill_shown/edited/confirmed`, `rest_auto_advance_paused`.
- Frontend: unit/RTL тесты для опросников и силового флоу.
- Backend: интеграционные тесты для новых типов данных (`readinessLogs`).
- Регрессия по сохранению `history` и `painLogs`.

## План реализации для агентов (TDD)
1. Red: добавить тесты на новые сценарии (опросники, старт, силовой режим, навигация, локальные настройки).
2. Green: минимальные изменения в `frontend/src/app.js` и `backend/server.js` под сценарии из требований.
3. Refactor: вынести повторяющиеся блоки/валидации, не меняя поведение.
4. Проверка аналитики: события и параметры соответствуют списку в разделе "План валидации".

## Чек-лист реализации (обновлять по мере внедрения)
Формат: [ ] не начато, [~] в работе, [x] готово.

### Frontend
- [x] Опросники: core/Подробнее, шкалы с якорями, пропуски.
- [x] Опросники: "Нет ограничений", "Другое", лимит 6-8 пунктов, prefill daily с подтверждением.
- [x] Микрокопирайтинг readiness/fatigue/RPE, подсказки под шкалами.
- [x] Фидбек готовности: категории + CTA, нейтральный тон.
- [ ] Навигация: возврат в список с сохранением контекста и подсказкой для deep-link.
- [ ] Экран старта: сканируемые блоки, "Еще N" для длинных списков, пустые состояния.
- [ ] Силовой режим: ввод параметров, по-подходам, отдых с 0 сек, редактирование между подходами.
- [ ] Авто-переход: отсчет, пауза, локальная настройка Вкл/Выкл.

### Backend/Data
- [~] Данные: `readinessLogs` + расширение `history` для силовых упражнений.
- [x] Миграция on-read и сохранение `schemaVersion`/`completionLevel`.

### Analytics
- [~] События из плана валидации отправляются корректно.

### Tests/QA
- [~] RTL тесты для фронта (опросники, старт, силовой флоу, навигация).
- [x] Интеграционные тесты для бэка (readinessLogs + history).
- [ ] Регрессия по сохранению `history` и `painLogs`.
